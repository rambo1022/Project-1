<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div class="container">
        <!-- Stock Select Box -->
        <div class="row">
            <form id="stock-form">

                <!-- Label for Text Box -->
                <label for="stock-input">Choose A Stock</label>

                <!-- Text Input Box -->
                <input type="text" id="stock-input"><br>

                <!-- Submit Button -->
                <input id="select-stock" type="submit" value="GO!">
            </form>
        </div>
        <!-- Stock Information -->
        <div class="row" id="header-div"></div>
        <div class="col-sm-3">
            <h1>Stock Name & Price</h1>
            <div id="stock-div"></div>
        </div>
        <!-- Options Information -->
        <div class="col-sm-3">
            <div id="header-div"></div>
            <h1>Options Heatmap</h1>
            <div id="strike div-div">
            </div>
        </div>

        <div class="col-sm-3">
            <div id="header-div"></div>
            <h1>Options Heatmap</h1>
            <div id="options-div">
            </div>
        </div>
        <!-- Options HeatMap -->
        <table cellpadding="0" cellspacing="0" border="1" class="heat-map">
            <thead>
                <tr>
                    <th class="first" id = "stock-name"></th>
                    <th>data 1</th>
                    <th>data 2</th>
                    <th>data 3</th>
                    <th>data 4</th>
                    <th>data 5</th>
                    <th class="last">data 6</th>
                </tr>
            </thead>
            <tbody>
                <tr class="stats-row" >
                    <td class="stats-title">Wanda</td>
                    <td id = "calloptions"></td>
                  
                </tr>
                <tr class="stats-row">
                    <td class="stats-title">Wanda</td>
                    <td ></td>
                  
                </tr>
                <tr class="stats-row">
                    <td class="stats-title">Wanda</td>
                    <td></td>
                   
                </tr>
                <tr class="stats-row">
                    <td class="stats-title">Wanda</td>
                    <td></td>
                  
                </tr>

            </tbody>
        </table>

        <!-- JQuery -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript">


            $("#select-stock").on("click", function (event) {
                // Preventing the button from trying to submit the form
                event.preventDefault();
                // Storing the stock name
                var inputStock = $("#stock-input").val().trim().toUpperCase()

                // Running the searchStocks function(passing in the symbol as an argument)
                searchStocks(inputStock);
                getOptions(inputStock);
                console.log(inputStock);
            });
            function searchStocks(inputStock) {
                //Yahoo Finance Api
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/get-detail" + "?region=US&lang=en&symbol=" + inputStock,
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-host": "apidojo-yahoo-finance-v1.p.rapidapi.com",
                        "x-rapidapi-key": "ea9381a499msh1c1d7c0f469c737p179f05jsnd2f7d7ffd270"
                    }
                }

                $.ajax(settings).done(function (response) {
                    console.log(response.quoteData[inputStock]);

                    var symbolName = $("<h1>").text(response.quoteData[inputStock].longName);
                    var symbolPrice = $("<h2>").text(response.quoteData[inputStock].regularMarketPrice.raw);

                    $("#stock-div").empty();
                    $("#stock-div").append(symbolName, symbolPrice);

                });
            }



            //Options 
            function getOptions(inputStock) {
                //Yahoo Finance Api
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-options?symbol=" + inputStock + "&date=1575590400",
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-host": "apidojo-yahoo-finance-v1.p.rapidapi.com",
                        "x-rapidapi-key": "ea9381a499msh1c1d7c0f469c737p179f05jsnd2f7d7ffd270"
                    }
                }
                //Sets the first box in the Table to the name of the Stock
                $("#stock-name").text(inputStock)
                $.ajax(settings).done(function (response) {
                    var call = response.contracts['calls']
                    console.log(response)
                    console.log(response.contracts['calls']['0'])
                    //Creates an array based of the list of option calls
                    var optionsarray = Array.from(response.contracts['calls']);
                   

                    console.log(optionsarray[u]['lastPrice']['raw'])
                    $("#options-div").empty();

                    var CallOptionsList = $("<h2>").text(response.contracts['calls']['0']['lastPrice']);
                    for (var i = 0; i < optionsarray.length; i++) {
                        var td = $("<td>")
                        var addTD = $("#calloptions").add(td) 
                        var CallOptions = $("<h2>").text(optionsarray[i]['lastPrice']['raw']);
                        $("#calloptions").append(CallOptions)

                    }
                    console.log(optionsarray.length)



                });
            }

        </script>
    </div>
</body>

</html>